
<body class="bg-light">

<div class="container mt-5">

 

  <!-- Add User Modal -->
  <div class="modal fade" id="add_user_modal" tabindex="-1" aria-labelledby="addUserModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-md">
      <div class="modal-content">

        <form id="addUserForm" autocomplete="off" novalidate>

          <div class="modal-header bg-primary text-white">
            <h5 class="modal-title" id="addUserModalLabel">Add New User</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>

          <div class="modal-body">

            <!-- Username -->
            <div class="mb-3">
              <label class="form-label fw-bold">Username</label>
              <input type="text" class="form-control" name="username" required pattern="[A-Za-z0-9_ ]+">
              <div class="invalid-feedback">
                Only letters, numbers, spaces, and underscores allowed.
              </div>
            </div>

            <!-- Email -->
            <div class="mb-3">
              <label class="form-label fw-bold">Email</label>
              <input type="email" class="form-control" name="email" required>
              <div class="invalid-feedback">Please enter a valid email.</div>
            </div>

            <!-- Password -->
            <div class="mb-3 position-relative">
              <label class="form-label fw-bold">Password</label>
              <input type="password" class="form-control" id="password" name="password" required minlength="6">
              <i class="bi bi-eye-slash toggle-password"
                 style="position:absolute; right:12px; top:38px; cursor:pointer; z-index:10;"></i>
              <div class="form-text">Minimum 6 characters</div>
            </div>

            <!-- Confirm Password -->
            <div class="mb-3 position-relative">
              <label class="form-label fw-bold">Confirm Password</label>
              <input type="password" class="form-control" id="confirm_password" required>
              <i class="bi bi-eye-slash toggle-password"
                 style="position:absolute; right:12px; top:38px; cursor:pointer; z-index:10;"></i>
              <div class="invalid-feedback">Passwords do not match.</div>
            </div>

            <!-- Role -->
            <div class="mb-3">
              <label class="form-label fw-bold">Role</label>
              <select class="form-select" name="role" required>
                <option disabled selected value="">Select Role</option>
                <option value="CO">CO</option>
                <option value="OC">OC</option>
                <option value="2IC">2IC</option>
                <option value="ADJUTANT">Adjutant</option>
                <option value="SEC NCO">SEC NCO</option>
                <option value="SEC JCO">SEC JCO</option>
                <option value="NCO">NCO</option>
              </select>
            </div>

          </div>

          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-primary" id="submitBtn">
              <span class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
              Add User
            </button>
          </div>

        </form>
      </div>
    </div>
  </div>

</div>

<!-- Bootstrap JS Bundle (includes Popper) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
  const form          = document.getElementById('addUserForm');
  const password      = document.getElementById('password');
  const confirmPwd    = document.getElementById('confirm_password');
  const submitBtn     = document.getElementById('submitBtn');
  const spinner       = submitBtn.querySelector('.spinner-border');

  // Toggle password visibility
  document.querySelectorAll('.toggle-password').forEach(icon => {
    icon.addEventListener('click', () => {
      const input = icon.previousElementSibling;
      if (input.type === 'password') {
        input.type = 'text';
        icon.classList.replace('bi-eye-slash', 'bi-eye');
      } else {
        input.type = 'password';
        icon.classList.replace('bi-eye', 'bi-eye-slash');
      }
    });
  });

  // Form submission
  form.addEventListener('submit', function (e) {
    e.preventDefault();

    confirmPwd.classList.remove('is-invalid');

    if (password.value !== confirmPwd.value) {
      confirmPwd.classList.add('is-invalid');
      confirmPwd.focus();
      return;
    }

    submitBtn.disabled = true;
    spinner.classList.remove('d-none');

    const formData = new FormData(form);

    fetch('/add_user', {  // Change to your actual endpoint
      method: 'POST',
      body: formData,
      headers: { 'X-Requested-With': 'XMLHttpRequest' }
    })
    .then(response => {
      if (!response.ok) throw new Error('Network error');
      return response.json();
    })
    .then(data => {
      if (data.status === 'success') {
        alert('✅ ' + data.message);
        form.reset();

        // Close the modal
        const modal = bootstrap.Modal.getInstance(document.getElementById('add_user_modal'));
        modal.hide();
      } else {
        alert('❌ ' + (data.message || 'Failed to add user'));
      }
    })
    .catch(() => {
      alert('❌ Server error. Please try again.');
    })
    .finally(() => {
      submitBtn.disabled = false;
      spinner.classList.add('d-none');
    });
  });
</script>


<!-- Fullscreen Attachment Modal -->
<style>
    .modal-content {
      animation: slideUp 0.3s ease-in-out;
      border-radius: 0.75rem;
      overflow: hidden;
    }
  
    @keyframes slideUp {
      from {
        transform: translateY(30px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }
  
    .modal-header {
      background: linear-gradient(135deg, #0d6efd, #0a58ca);
      border-bottom: none;
    }
  
    .modal-title i {
      margin-right: 0.5rem;
    }
  
    .table {
      margin-bottom: 0;
    }
  
    .table thead {
      background-color: #f8f9fa;
    }
  
    .table th {
      font-weight: 600;
      color: #495057;
      border-top: none;
    }
  
    .table tbody tr:hover {
      background-color: #f1f3f5;
      transition: background-color 0.2s ease;
    }
  
    .name-cell {
      font-weight: 600;
      color: #212529;
    }
  
    .action-btn {
      padding: 0.35rem 0.75rem;
      font-size: 0.875rem;
    }
  
    .empty-state {
      color: #6c757d;
      font-style: italic;
    }
  
    .loading-state {
      color: #0d6efd;
    }
  
    .error-state {
      color: #dc3545;
    }
  </style>
  
  <div class="modal fade" id="attachmentModal" tabindex="-1" aria-labelledby="attachmentModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-fullscreen modal-dialog-scrollable">
      <div class="modal-content shadow-lg">
  
        <!-- Modal Header -->
        <div class="modal-header text-white">
          <h4 class="modal-title fw-semibold" id="attachmentModalLabel">
            ðŸ“Ž Attachment Details
          </h4>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
  
        <!-- Modal Body -->
        <div class="modal-body p-0">
          <div class="table-responsive">
            <table class="table table-hover table-bordered text-center mb-0 align-middle">
              <thead class="bg-light">
                <tr>
                  <th>Army No</th>
                  <th>Rank</th>
                  <th>Name</th>
                  <th>Company</th>
                  <th>Location</th>
                  <th>Authority</th>
                  <th>From Date</th>
                  <th>Action</th>
                </tr>
              </thead>
  
              <tbody id="attachmentTableBody">
                <tr>
                  <td colspan="8" class="py-5 loading-state">
                    <div class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></div>
                    Loading attachment details...
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
  
      </div>
    </div>
  </div>
  
  <script>
  /* Load data when modal opens */
  document.getElementById("attachmentModal").addEventListener("show.bs.modal", async () => {
    const tbody = document.getElementById("attachmentTableBody");
  
    tbody.innerHTML = `
      <tr>
        <td colspan="8" class="py-5 loading-state">
          <div class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></div>
          Fetching data...
        </td>
      </tr>
    `;
  
    try {
      const res = await fetch("/stats/attachment-details");
      const data = await res.json();
  
      tbody.innerHTML = "";
  
      if (!data.length) {
        tbody.innerHTML = `
          <tr>
            <td colspan="8" class="py-5 empty-state">
              <i class="bi bi-inbox fs-1 d-block mb-3 text-muted"></i>
              No attachment records found
            </td>
          </tr>
        `;
        return;
      }
  
      data.forEach(p => {
        tbody.insertAdjacentHTML("beforeend", `
          <tr id="row-${p.army_number}">
            <td>${p.army_number}</td>
            <td>${p.rank}</td>
            <td class="name-cell">${p.name}</td>
            <td>${p.company}</td>
            <td>${p.lcoation}</td>
            <td>${p.authority}</td>
            <td>${p.td_date}</td>
            <td>
              <button
                class="btn btn-sm btn-outline-danger action-btn"
                onclick="deleteAttachment('${p.army_number}')">
                <i class="bi bi-trash"></i> Delete
              </button>
            </td>
          </tr>
        `);
      });
  
    } catch (err) {
      tbody.innerHTML = `
        <tr>
          <td colspan="8" class="py-5 error-state">
            <i class="bi bi-exclamation-triangle fs-1 d-block mb-3"></i>
            Failed to load data
          </td>
        </tr>
      `;
    }
  });
  
  /* Delete by army_number */
  async function deleteAttachment(army_number) {
    if (!confirm("Are you sure you want to delete this attachment?")) return;
  
    try {
      const res = await fetch(`/stats/delete-attachment/${army_number}`, {
        method: "DELETE"
      });
  
      const result = await res.json();
  
      if (res.ok) {
        document.getElementById(`row-${army_number}`).remove();
      } else {
        alert(result.error || "Delete failed");
      }
  
    } catch (err) {
      alert("Server error while deleting");
    }
  }
  </script>
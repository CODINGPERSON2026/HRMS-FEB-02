<!-- Toast Container -->
<div id="toastContainer" class="position-fixed bottom-0 end-0 p-3" style="z-index: 1055"></div>

<script>
async function showAssignedAlarms() {
    try {
        const res = await fetch('/api/assigned_alarm');
        if (!res.ok) throw new Error("Network error");
        const result = await res.json();

        const container = document.getElementById("toastContainer");
        container.innerHTML = ""; // Clear previous toasts

        if(result.rows && result.rows.length > 0) {
            result.rows.forEach((row, index) => {
                // Create toast element
                const toastEl = document.createElement("div");
                toastEl.className = "toast align-items-center text-bg-danger border-0 mb-2";
                toastEl.role = "alert";
                toastEl.ariaLive = "assertive";
                toastEl.ariaAtomic = "true";

                toastEl.innerHTML = `
                    <div class="d-flex">
                        <div class="toast-body">
                            ðŸ”” DET ALARM! Name : ${row.name},
                             Army Number: ${row.army_number}, Det Name: ${row.det_name}
                        </div>
                        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                    </div>
                `;

                // Append toast but hide initially for smooth fade-in
                toastEl.style.opacity = 0;
                container.appendChild(toastEl);

                // Delay each toast appearance slightly for smooth stacking
                setTimeout(() => {
                    const bsToast = new bootstrap.Toast(toastEl, { autohide: true, delay: 30000 });
                    bsToast.show();

                    // Fade-in effect
                    toastEl.style.transition = "opacity 0.5s ease-in-out";
                    toastEl.style.opacity = 1;
                }, index * 600); // stagger by 300ms for each toast
            });
        }
    } catch (err) {
        console.error("Error fetching assigned alarms:", err);
    }
}

// Run only on page load / refresh
document.addEventListener('DOMContentLoaded', showAssignedAlarms);
</script>
